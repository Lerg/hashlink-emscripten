// Generated by HLC 4.2.1 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <haxe/Timer.h>
#include <sys/thread/EventLoop.h>
void haxe_Timer_run(haxe__Timer);
extern hl_type t$fun_66d087d;
sys__thread___Thread__HaxeThread sys_thread__Thread_Thread_Impl__current(void);
sys__thread__EventLoop sys_thread__Thread_Thread_Impl__get_events(sys__thread___Thread__HaxeThread);
sys__thread___EventLoop__RegularEvent sys_thread_EventLoop_repeat(sys__thread__EventLoop,vclosure*,int);
void sys_thread_EventLoop_cancel(sys__thread__EventLoop,sys__thread___EventLoop__RegularEvent);
extern hl_type t$haxe_Timer;
extern hl_type t$ctx_fec7ba4;
extern hl_type t$fun_2322471;

void haxe_Timer_new__$1(haxe__Timer r0) {
	vclosure *r2;
	if( r0 == NULL ) hl_null_access();
	r2 = r0->run;
	if( r2 == NULL ) hl_null_access();
	r2->hasValue ? ((void (*)(vdynamic*))r2->fun)((vdynamic*)r2->value) : ((void (*)(void))r2->fun)();
	return;
}

void haxe_Timer_new(haxe__Timer r0,int r1) {
	sys__thread___Thread__HaxeThread r4;
	sys__thread__EventLoop r6;
	sys__thread___EventLoop__RegularEvent r5;
	vclosure *r2;
	r2 = r0->run;
	if( r2 ) goto label$dcfb79f_2_4;
	r2 = hl_alloc_closure_ptr(&t$fun_66d087d,haxe_Timer_run,r0);
	r0->run = r2;
	label$dcfb79f_2_4:
	r4 = sys_thread__Thread_Thread_Impl__current();
	r0->thread = r4;
	r4 = r0->thread;
	r6 = sys_thread__Thread_Thread_Impl__get_events(r4);
	if( r6 == NULL ) hl_null_access();
	r2 = hl_alloc_closure_ptr(&t$fun_66d087d,haxe_Timer_new__$1,r0);
	r5 = sys_thread_EventLoop_repeat(r6,r2,r1);
	r0->eventHandler = r5;
	return;
}

void haxe_Timer_stop(haxe__Timer r0) {
	sys__thread___Thread__HaxeThread r3;
	sys__thread___EventLoop__RegularEvent r4;
	sys__thread__EventLoop r2;
	r3 = r0->thread;
	r2 = sys_thread__Thread_Thread_Impl__get_events(r3);
	if( r2 == NULL ) hl_null_access();
	r4 = r0->eventHandler;
	sys_thread_EventLoop_cancel(r2,r4);
	return;
}

void haxe_Timer_run(haxe__Timer r0) {
	return;
}

void haxe_Timer_delay__$1(venum* r0) {
	haxe__Timer r2;
	vclosure *r3;
	r2 = ((Enumt$ctx_fec7ba4*)r0)->p1;
	if( r2 == NULL ) hl_null_access();
	haxe_Timer_stop(r2);
	r3 = ((Enumt$ctx_fec7ba4*)r0)->p0;
	if( r3 == NULL ) hl_null_access();
	r3->hasValue ? ((void (*)(vdynamic*))r3->fun)((vdynamic*)r3->value) : ((void (*)(void))r3->fun)();
	return;
}

haxe__Timer haxe_Timer_delay(vclosure* r0,int r1) {
	venum *r5;
	haxe__Timer r2;
	vclosure *r4;
	r2 = (haxe__Timer)hl_alloc_obj(&t$haxe_Timer);
	haxe_Timer_new(r2,r1);
	r5 = hl_alloc_enum(&t$ctx_fec7ba4,0);
	((Enumt$ctx_fec7ba4*)r5)->p0 = (vclosure*)r0;
	((Enumt$ctx_fec7ba4*)r5)->p1 = (haxe__Timer)r2;
	r4 = hl_alloc_closure_ptr(&t$fun_2322471,haxe_Timer_delay__$1,r5);
	r2->run = r4;
	return r2;
}

